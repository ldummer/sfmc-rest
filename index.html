<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>test 6</title>

    <script src="js/jquery.min.js"></script>
    <script src="js/postmonger.js"></script>
    <script type="text/javascript" src="js/require.js" data-main="customActivity"></script>
    <script type="text/javascript">
   var connection = new Postmonger.Session();
var payload = {};

$(window).ready(onRender);

connection.on('initActivity', initialize);
connection.on('clickedNext', save);

function onRender() {
  connection.trigger('ready');
}

function initialize(data) {

  if (data) {
    payload = data;
  }

  connection.trigger('requestSchema');
  connection.on('requestedSchema', function (data) {

    // add entry source attributes as inArgs
    const schema = data['schema'];
    console.log(schema)

    for (var i = 0, l = schema.length; i < l; i++) {
        var inArg = {};
        let attr = schema[i].key;
        let keyIndex = attr.lastIndexOf('.') + 1;
        console.log(attr);
        inArg[attr.substring(keyIndex)] = '{{' + attr + '}}';
        payload['arguments'].execute.inArguments.push(inArg);
    }
  });

  let argArr = payload['arguments'].execute.inArguments;

  console.log(argArr);

}

function save() {

  /* the following code is optional, but provides an example of 
     how to append additional key/value pair(s) as inArguments, 
     for example, a form field value from the custom activity html

  var fieldVal = document.getElementById('your-field-id').value;
  var keyObj = { InsertKeyName: fieldVal };
  payload['arguments'].execute.inArguments.push(keyObj);

  */

  payload.metaData.isConfigured = true;
  connection.trigger('updateActivity', payload);

}

function onClickedNext() {
  payload.metaData.isConfigured = true;
  connection.trigger('updateActivity', payload);
}
    </script>

    <!--Styles-->
    <style type="text/css">
      body {
        padding: 20px;
        margin: 0;
      }
      .step {
        display: none;
      }
      #step1 {
        display: block;
      }
    </style>
  </head>
  <body>
   <h1>Message 3</h1>
  </body>
</html>